var Z=Object.create;var J=Object.defineProperty,tt=Object.defineProperties,et=Object.getOwnPropertyDescriptor,rt=Object.getOwnPropertyDescriptors,it=Object.getOwnPropertyNames,V=Object.getOwnPropertySymbols,nt=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable;var T=(t,r,e)=>r in t?J(t,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[r]=e,x=(t,r)=>{for(var e in r||(r={}))F.call(r,e)&&T(t,e,r[e]);if(V)for(var e of V(r))st.call(r,e)&&T(t,e,r[e]);return t},A=(t,r)=>tt(t,rt(r)),ot=t=>J(t,"__esModule",{value:!0});var at=(t,r,e)=>{if(r&&typeof r=="object"||typeof r=="function")for(let o of it(r))!F.call(t,o)&&o!=="default"&&J(t,o,{get:()=>r[o],enumerable:!(e=et(r,o))||e.enumerable});return t},u=t=>at(ot(J(t!=null?Z(nt(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var O=u(require("path")),h=u(require("fs")),Y=u(require("glob"));var v=u(require("@babel/traverse")),i=u(require("@babel/types")),B=u(require("path")),g=u(require("@vue/compiler-core"));var D=u(require("@vue/compiler-sfc")),y=u(require("@babel/parser"));function U(t){return(0,D.parse)(t).descriptor}function R(t){return(0,y.parse)(t,{sourceType:"module",plugins:["jsx"]})}var b=u(require("@babel/generator")),X=u(require("prettier"));function L(t){return(0,b.default)(t,{compact:!1,jsescOption:{quotes:"single"}}).code.replace(/;/gm,"")}function P(t){return(0,b.default)(t).code}function j(t){let r="",{template:e,script:o,scriptSetup:l,styles:c,customBlocks:a}=t;return[e,o,l,...c,...a].forEach(n=>{(n==null?void 0:n.type)&&(r+=`<${n.type}${Object.entries(n.attrs).reduce((f,[m,S])=>(S===!0?f+=` ${m}`:f+=` ${m}="${S}"`,f)," ")}>${n.content}</${n.type}>`)}),X.default.format(r,{parser:"vue",semi:!0,singleQuote:!0})}function $(t,r=""){var e;return((e=t==null?void 0:t.children)==null?void 0:e.length)&&(r=t.children.reduce((o,l)=>o+$(l),"")),t.type===1?lt(t,r):t.loc.source}function lt(t,r){let e="";if(t.props.length&&(e=` ${ct(t.props)}`),t.tag){let o=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];return t.isSelfClosing||o.includes(t.tag)?`<${t.tag}${e} />`:`<${t.tag}${e}>${r}</${t.tag}>`}return r}function ct(t){return t.map(r=>r.loc.source).join(" ")}var C=u(require("chalk")),_=u(require("fs")),w=u(require("path"));function p(t){return t&&/[\u{4E00}-\u{9FFF}]/gmu.test(t)}function I(t){console.log(C.default.red(t))}function M(t){console.log(C.default.yellow(t))}function W(t){console.log(C.default.white(t))}function K(t){console.log(C.default.cyan(t))}function d(t){if(_.default.existsSync(t))return!0;if(d(w.default.dirname(t)))return _.default.mkdirSync(t),!0}"use strict";var{createHash:ft}=require("crypto");function q(t,r){let e=ft("md5");return e.update(t),e.digest("hex").slice(0,r)}var E;(function(e){e.JS=".js",e.VUE=".vue"})(E||(E={}));var k;(function(s){s[s.ROOT=0]="ROOT",s[s.ELEMENT=1]="ELEMENT",s[s.TEXT=2]="TEXT",s[s.COMMENT=3]="COMMENT",s[s.SIMPLE_EXPRESSION=4]="SIMPLE_EXPRESSION",s[s.INTERPOLATION=5]="INTERPOLATION",s[s.ATTRIBUTE=6]="ATTRIBUTE",s[s.DIRECTIVE=7]="DIRECTIVE",s[s.COMPOUND_EXPRESSION=8]="COMPOUND_EXPRESSION",s[s.IF=9]="IF",s[s.IF_BRANCH=10]="IF_BRANCH",s[s.FOR=11]="FOR",s[s.TEXT_CALL=12]="TEXT_CALL",s[s.VNODE_CALL=13]="VNODE_CALL",s[s.JS_CALL_EXPRESSION=14]="JS_CALL_EXPRESSION",s[s.JS_OBJECT_EXPRESSION=15]="JS_OBJECT_EXPRESSION",s[s.JS_PROPERTY=16]="JS_PROPERTY",s[s.JS_ARRAY_EXPRESSION=17]="JS_ARRAY_EXPRESSION",s[s.JS_FUNCTION_EXPRESSION=18]="JS_FUNCTION_EXPRESSION",s[s.JS_CONDITIONAL_EXPRESSION=19]="JS_CONDITIONAL_EXPRESSION",s[s.JS_CACHE_EXPRESSION=20]="JS_CACHE_EXPRESSION",s[s.JS_BLOCK_STATEMENT=21]="JS_BLOCK_STATEMENT",s[s.JS_TEMPLATE_LITERAL=22]="JS_TEMPLATE_LITERAL",s[s.JS_IF_STATEMENT=23]="JS_IF_STATEMENT",s[s.JS_ASSIGNMENT_EXPRESSION=24]="JS_ASSIGNMENT_EXPRESSION",s[s.JS_SEQUENCE_EXPRESSION=25]="JS_SEQUENCE_EXPRESSION",s[s.JS_RETURN_STATEMENT=26]="JS_RETURN_STATEMENT"})(k||(k={}));function H(t,r,e){return t==="on"?{name:"on",type:g.NodeTypes.DIRECTIVE,loc:{source:`@${r}="${e}"`}}:{name:"bind",type:g.NodeTypes.DIRECTIVE,loc:{source:`:${r}="${e}"`}}}function N(t){return{type:g.NodeTypes.INTERPOLATION,loc:{source:`{{ ${t} }}`}}}var G=class{result="";locales={};sourceCode;filename;fileType;importVar="I18N";importPath="";constructor({code:r,locales:e,importPath:o,filename:l}){this.sourceCode=r,this.result=r,this.locales=e,this.importPath=o,this.filename=l,this.fileType=B.default.extname(l),this.startTransform()}startTransform(){var r,e,o,l,c,a;if(!Object.values(E).includes(this.fileType)){I(`Unsupported file type: ${this.filename}`);return}if(p(this.sourceCode)){if(this.fileType===E.JS&&this.hasChineseCharacterInJS(this.sourceCode))this.result=P(this.transformJS(this.sourceCode));else if(this.fileType===E.VUE){let n=U(this.sourceCode);((r=n==null?void 0:n.template)==null?void 0:r.content)&&p((e=n==null?void 0:n.template)==null?void 0:e.content)&&(n.template.content=$(A(x({},this.transformTemplate(n==null?void 0:n.template.ast)),{tag:""}))),((o=n==null?void 0:n.script)==null?void 0:o.content)&&this.hasChineseCharacterInJS((l=n==null?void 0:n.script)==null?void 0:l.content)?n.script.content=P(this.transformJS(n.script.content)):((c=n==null?void 0:n.scriptSetup)==null?void 0:c.content)&&this.hasChineseCharacterInJS((a=n==null?void 0:n.scriptSetup)==null?void 0:a.content)&&(n.scriptSetup.content=P(this.transformJS(n.scriptSetup.content))),this.result=j(n)}}}hasChineseCharacterInJS=r=>{let e=!1;return(0,v.default)(R(r),{enter:o=>{var l;o.node.type==="StringLiteral"&&p((l=o.node.extra)==null?void 0:l.rawValue)&&(o.stop(),e=!0),o.node.type==="TemplateLiteral"&&o.node.quasis.some(c=>p(c.value.cooked))&&(o.stop(),e=!0),o.node.type==="JSXText"&&p(o.node.value)&&(o.stop(),e=!0)}}),e};transformTemplate=r=>r.type===g.NodeTypes.ELEMENT&&/^<+?[^>]+\s+(v-pre)[^>]*>+?[\s\S]*<+?\/[\s\S]*>+?$/gm.test(r.loc.source)?(r.props=[{type:g.NodeTypes.DIRECTIVE,name:"pre",loc:{source:"v-pre"}}],r):(r.props.length&&(r.props=r.props.map(e=>{var o,l,c,a;if(e.type===g.NodeTypes.DIRECTIVE&&p((o=e.exp)==null?void 0:o.content)){let n=L(this.transformJS((l=e.exp)==null?void 0:l.content,!0));return H(e.name,(c=e.arg)==null?void 0:c.content,n)}if(e.type===g.NodeTypes.ATTRIBUTE&&p((a=e.value)==null?void 0:a.content)){let n=this.extractChar(e.value.content);return H("bind",e.name,`$t('${n}')`)}return e})),r.children.length&&(r.children=r.children.map(e=>{var o,l;if(e.type===g.NodeTypes.TEXT&&p(e.content)){let c=this.extractChar(e.content);return N(`$t('${c}')`)}if(e.type===g.NodeTypes.INTERPOLATION&&p((o=e.content)==null?void 0:o.content)){let c=L(this.transformJS((l=e.content)==null?void 0:l.content,!0));return N(c)}return e.type===g.NodeTypes.ELEMENT?this.transformTemplate(e):e})),r);transformJS=(r,e)=>{let o=R(r),l=!1;return(0,v.default)(o,{Program:{exit:a=>{this.fileType===E.JS&&(a.traverse({ImportDeclaration:n=>{n.node.specifiers.find(f=>f.local.name===this.importVar)&&(l=!1,n.stop())}}),l&&a.unshiftContainer("body",i.importDeclaration([i.importDefaultSpecifier(i.identifier(this.importVar))],i.stringLiteral(this.importPath))))}},StringLiteral:{exit:a=>{var n,f;if(p((n=a.node.extra)==null?void 0:n.rawValue)){let m=this.extractChar((f=a.node.extra)==null?void 0:f.rawValue);this.fileType===E.JS?(l=!0,a.replaceWith(i.callExpression(i.memberExpression(i.identifier(this.importVar),i.identifier("t")),[i.stringLiteral(m)]))):this.fileType===E.VUE&&(e?a.replaceWith(i.callExpression(i.identifier("$t"),[i.stringLiteral(m)])):a.replaceWith(i.callExpression(i.memberExpression(i.thisExpression(),i.identifier("$t")),[i.stringLiteral(m)])))}}},TemplateLiteral:{exit:a=>{var n;if(a.node.quasis.some(f=>p(f.value.cooked))){let f=a.node.quasis.map(z=>z.value.cooked).join("%s"),m=this.extractChar(f),S=!!((n=a.node.expressions)==null?void 0:n.length);this.fileType===E.JS?(l=!0,S?a.replaceWith(i.callExpression(i.memberExpression(i.identifier(this.importVar),i.identifier("tExtend")),[i.stringLiteral(m),i.arrayExpression(a.node.expressions)])):a.replaceWith(i.callExpression(i.memberExpression(i.identifier(this.importVar),i.identifier("t")),[i.stringLiteral(m)]))):this.fileType===E.VUE&&(e?S?a.replaceWith(i.callExpression(i.memberExpression(i.identifier("$i18n"),i.identifier("tExtend")),[i.stringLiteral(m),i.arrayExpression(a.node.expressions)])):a.replaceWith(i.callExpression(i.identifier("$t"),[i.stringLiteral(m)])):S?a.replaceWith(i.callExpression(i.memberExpression(i.memberExpression(i.thisExpression(),i.identifier("$i18n")),i.identifier("tExtend")),[i.stringLiteral(m),i.arrayExpression(a.node.expressions)])):a.replaceWith(i.callExpression(i.memberExpression(i.thisExpression(),i.identifier("$t")),[i.stringLiteral(m)])))}}},JSXText:{exit:a=>{var n;if(p(a.node.value)){let f=this.extractChar((n=a.node.extra)==null?void 0:n.rawValue);a.replaceWith(i.jsxExpressionContainer(i.callExpression(i.identifier("$t"),[i.stringLiteral(f)])))}}}}),o};extractChar=r=>{let e=r.trim(),o=q(e);return this.locales[o]=e,o}},Q=G;module.exports=function(t){let r={pattern:"**/*.{vue,js}",ignore:["node_modules/**"],output:"i18n/zh-CN.json",useUniqKey:!1,importPath:""};try{let l=h.default.readFileSync(O.default.resolve(process.cwd(),"package.json"),"utf8"),c=JSON.parse(l);c.trust&&(r=x(x({},r),c.trust))}catch(l){I(l),process.exit(1)}t.output&&(r.output=t.output),t.import&&(r.importPath=t.import),r.importPath||(I("Please set importExpression's filepath."),process.exit(1));let e={},o=O.default.resolve(process.cwd(),r.output);if(h.default.existsSync(o)){let l=h.default.readFileSync(o,"utf8");l&&(e=JSON.parse(l))}Y.default.sync(r.pattern,{ignore:r.ignore}).forEach(l=>{let c=O.default.resolve(process.cwd(),l);W(`\u{1F680} detecting file: ${c}`);let a=h.default.readFileSync(c,"utf8");try{let{result:n}=new Q({code:a,locales:e,useUniqKey:r.useUniqKey,importPath:r.importPath,filename:l});h.default.writeFileSync(c,n,"utf8")}catch(n){console.log(n)}}),Object.keys(e).length?(d(O.default.dirname(o)),h.default.writeFileSync(o,JSON.stringify(e,null,"	"),"utf8"),K("\u{1F389}\u{1F389}\u{1F389} Extract successfully!")):M("There is no chinese characters can be found in specified directory.")};
//# sourceMappingURL=index.js.map
