var te=Object.create;var I=Object.defineProperty,re=Object.defineProperties,ie=Object.getOwnPropertyDescriptor,ne=Object.getOwnPropertyDescriptors,se=Object.getOwnPropertyNames,j=Object.getOwnPropertySymbols,oe=Object.getPrototypeOf,F=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var w=(e,i,t)=>i in e?I(e,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[i]=t,b=(e,i)=>{for(var t in i||(i={}))F.call(i,t)&&w(e,t,i[t]);if(j)for(var t of j(i))ae.call(i,t)&&w(e,t,i[t]);return e},D=(e,i)=>re(e,ne(i)),le=e=>I(e,"__esModule",{value:!0});var ce=(e,i,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of se(i))!F.call(e,s)&&s!=="default"&&I(e,s,{get:()=>i[s],enumerable:!(t=ie(i,s))||t.enumerable});return e},p=e=>ce(le(I(e!=null?te(oe(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var O=p(require("path")),h=p(require("fs")),N=p(require("glob")),Z=p(require("commander"));var y=p(require("@babel/traverse")),r=p(require("@babel/types")),H=p(require("path"));var A=p(require("@vue/compiler-sfc")),U=p(require("@babel/parser"));function X(e){return(0,A.parse)(e).descriptor}function P(e){return(0,U.parse)(e,{sourceType:"module",plugins:["jsx"]})}var _=p(require("@babel/generator")),W=p(require("prettier"));function v(e){return(0,_.default)(e,{compact:!1,jsescOption:{quotes:"single"}}).code.replace(/;/gm,"")}function J(e){return(0,_.default)(e).code}function K(e){let i="",{template:t,script:s,scriptSetup:l,styles:u,customBlocks:a}=e;return[t,s,l,...u,...a].forEach(c=>{(c==null?void 0:c.type)&&(i+=`<${c.type}${Object.entries(c.attrs).reduce((o,[f,S])=>(S===!0?o+=` ${f}`:o+=` ${f}="${S}"`,o)," ")}>${c.content}</${c.type}>`)}),W.default.format(i,{parser:"vue",semi:!0,singleQuote:!0})}function R(e,i=""){var t;return((t=e==null?void 0:e.children)==null?void 0:t.length)&&(i=e.children.reduce((s,l)=>s+R(l),"")),e.type===1?ue(e,i):e.loc.source}function ue(e,i){let t="";if(e.props.length&&(t=` ${pe(e.props)}`),e.tag){let s=["area","base","br","col","embed","hr","img","input","link","meta","param","source","track","wbr"];return e.isSelfClosing||s.includes(e.tag)?`<${e.tag}${t} />`:`<${e.tag}${t}>${i}</${e.tag}>`}return i}function pe(e){return e.map(i=>i.loc.source).join(" ")}var C=p(require("chalk")),$=p(require("fs")),k=p(require("path"));function m(e){return e&&/[\u{4E00}-\u{9FFF}]/gmu.test(e)}function d(e){console.log(C.default.red(e))}function q(e){console.log(C.default.yellow(e))}function M(e){console.log(C.default.white(e))}function T(e){console.log(C.default.cyan(e))}function L(e){if($.default.existsSync(e))return!0;if(L(k.default.dirname(e)))return $.default.mkdirSync(e),!0}"use strict";var{createHash:fe}=require("crypto");function B(e,i){let t=fe("md5");return t.update(e),t.digest("hex").slice(0,i)}var g;(function(t){t.JS=".js",t.VUE=".vue"})(g||(g={}));var x;(function(n){n[n.ROOT=0]="ROOT",n[n.ELEMENT=1]="ELEMENT",n[n.TEXT=2]="TEXT",n[n.COMMENT=3]="COMMENT",n[n.SIMPLE_EXPRESSION=4]="SIMPLE_EXPRESSION",n[n.INTERPOLATION=5]="INTERPOLATION",n[n.ATTRIBUTE=6]="ATTRIBUTE",n[n.DIRECTIVE=7]="DIRECTIVE",n[n.COMPOUND_EXPRESSION=8]="COMPOUND_EXPRESSION",n[n.IF=9]="IF",n[n.IF_BRANCH=10]="IF_BRANCH",n[n.FOR=11]="FOR",n[n.TEXT_CALL=12]="TEXT_CALL",n[n.VNODE_CALL=13]="VNODE_CALL",n[n.JS_CALL_EXPRESSION=14]="JS_CALL_EXPRESSION",n[n.JS_OBJECT_EXPRESSION=15]="JS_OBJECT_EXPRESSION",n[n.JS_PROPERTY=16]="JS_PROPERTY",n[n.JS_ARRAY_EXPRESSION=17]="JS_ARRAY_EXPRESSION",n[n.JS_FUNCTION_EXPRESSION=18]="JS_FUNCTION_EXPRESSION",n[n.JS_CONDITIONAL_EXPRESSION=19]="JS_CONDITIONAL_EXPRESSION",n[n.JS_CACHE_EXPRESSION=20]="JS_CACHE_EXPRESSION",n[n.JS_BLOCK_STATEMENT=21]="JS_BLOCK_STATEMENT",n[n.JS_TEMPLATE_LITERAL=22]="JS_TEMPLATE_LITERAL",n[n.JS_IF_STATEMENT=23]="JS_IF_STATEMENT",n[n.JS_ASSIGNMENT_EXPRESSION=24]="JS_ASSIGNMENT_EXPRESSION",n[n.JS_SEQUENCE_EXPRESSION=25]="JS_SEQUENCE_EXPRESSION",n[n.JS_RETURN_STATEMENT=26]="JS_RETURN_STATEMENT"})(x||(x={}));function G(e,i,t){return e==="on"?{name:"on",type:x.DIRECTIVE,loc:{source:`@${i}="${t}"`}}:{name:"bind",type:x.DIRECTIVE,loc:{source:`:${i}="${t}"`}}}function Q(e){return{type:x.INTERPOLATION,loc:{source:`{{ ${e} }}`}}}var Y=class{result="";locales={};sourceCode;filename;fileType;importVar="I18N";importPath="";constructor({code:i,locales:t,importPath:s,filename:l}){this.sourceCode=i,this.result=i,this.locales=t,this.importPath=s,this.filename=l,this.fileType=H.default.extname(l),this.startTransform()}startTransform(){var i,t,s,l,u,a,c;if(!Object.values(g).includes(this.fileType)){d(`Unsupported file type: ${this.filename}`);return}if(m(this.sourceCode)){if(this.fileType===g.JS&&this.hasChineseCharacterInJS(this.sourceCode))this.result=J(this.transformJS(this.sourceCode));else if(this.fileType===g.VUE){let o=X(this.sourceCode);((i=o==null?void 0:o.template)==null?void 0:i.content)&&m((t=o==null?void 0:o.template)==null?void 0:t.content)&&(o.template.content=R(D(b({},this.transformTemplate((s=o==null?void 0:o.template)==null?void 0:s.ast)),{tag:""}))),((l=o==null?void 0:o.script)==null?void 0:l.content)&&this.hasChineseCharacterInJS((u=o==null?void 0:o.script)==null?void 0:u.content)?o.script.content=J(this.transformJS(o.script.content)):((a=o==null?void 0:o.scriptSetup)==null?void 0:a.content)&&this.hasChineseCharacterInJS((c=o==null?void 0:o.scriptSetup)==null?void 0:c.content)&&(o.scriptSetup.content=J(this.transformJS(o.scriptSetup.content))),this.result=K(o)}}}hasChineseCharacterInJS=i=>{let t=!1;return(0,y.default)(P(i),{enter:s=>{var l;s.node.type==="StringLiteral"&&m((l=s.node.extra)==null?void 0:l.rawValue)&&(s.stop(),t=!0),s.node.type==="TemplateLiteral"&&s.node.quasis.some(u=>m(u.value.cooked))&&(s.stop(),t=!0),s.node.type==="JSXText"&&m(s.node.value)&&(s.stop(),t=!0)}}),t};transformTemplate=i=>i.type===1&&/^<+?[^>]+\s+(v-pre)[^>]*>+?[\s\S]*<+?\/[\s\S]*>+?$/gm.test(i.loc.source)?(i.props=[{type:7,name:"pre",loc:{source:"v-pre"}}],i):(i.props.length&&(i.props=i.props.map(t=>{var s,l,u,a;if(t.type===7&&m((s=t.exp)==null?void 0:s.content)){let c=v(this.transformJS((l=t.exp)==null?void 0:l.content,!0));return G(t.name,(u=t.arg)==null?void 0:u.content,c)}if(t.type===6&&m((a=t.value)==null?void 0:a.content)){let c=this.extractChar(t.value.content);return G("bind",t.name,`$t('${c}')`)}return t})),i.children.length&&(i.children=i.children.map(t=>{var s,l;if(t.type===2&&m(t.content)){let u=this.extractChar(t.content);return Q(`$t('${u}')`)}if(t.type===5&&m((s=t.content)==null?void 0:s.content)){let u=v(this.transformJS((l=t.content)==null?void 0:l.content,!0));return Q(u)}return t.type===1?this.transformTemplate(t):t})),i);transformJS=(i,t)=>{let s=P(i),l=!1;return(0,y.default)(s,{Program:{exit:a=>{this.fileType===g.JS&&(a.traverse({ImportDeclaration:c=>{c.node.specifiers.find(o=>o.local.name===this.importVar)&&(l=!1,c.stop())}}),l&&a.unshiftContainer("body",r.importDeclaration([r.importDefaultSpecifier(r.identifier(this.importVar))],r.stringLiteral(this.importPath))))}},StringLiteral:{exit:a=>{var c,o;if(m((c=a.node.extra)==null?void 0:c.rawValue)){let f=this.extractChar((o=a.node.extra)==null?void 0:o.rawValue);this.fileType===g.JS?(l=!0,a.replaceWith(r.callExpression(r.memberExpression(r.identifier(this.importVar),r.identifier("t")),[r.stringLiteral(f)]))):this.fileType===g.VUE&&(t?a.replaceWith(r.callExpression(r.identifier("$t"),[r.stringLiteral(f)])):a.replaceWith(r.callExpression(r.memberExpression(r.thisExpression(),r.identifier("$t")),[r.stringLiteral(f)])))}}},TemplateLiteral:{exit:a=>{var c;if(a.node.quasis.some(o=>m(o.value.cooked))){let o=a.node.quasis.map(ee=>ee.value.cooked).join("%s"),f=this.extractChar(o),S=!!((c=a.node.expressions)==null?void 0:c.length);this.fileType===g.JS?(l=!0,S?a.replaceWith(r.callExpression(r.memberExpression(r.identifier(this.importVar),r.identifier("tExtend")),[r.stringLiteral(f),r.arrayExpression(a.node.expressions)])):a.replaceWith(r.callExpression(r.memberExpression(r.identifier(this.importVar),r.identifier("t")),[r.stringLiteral(f)]))):this.fileType===g.VUE&&(t?S?a.replaceWith(r.callExpression(r.memberExpression(r.identifier("$i18n"),r.identifier("tExtend")),[r.stringLiteral(f),r.arrayExpression(a.node.expressions)])):a.replaceWith(r.callExpression(r.identifier("$t"),[r.stringLiteral(f)])):S?a.replaceWith(r.callExpression(r.memberExpression(r.memberExpression(r.thisExpression(),r.identifier("$i18n")),r.identifier("tExtend")),[r.stringLiteral(f),r.arrayExpression(a.node.expressions)])):a.replaceWith(r.callExpression(r.memberExpression(r.thisExpression(),r.identifier("$t")),[r.stringLiteral(f)])))}}},JSXText:{exit:a=>{var c;if(m(a.node.value)){let o=this.extractChar((c=a.node.extra)==null?void 0:c.rawValue);a.replaceWith(r.jsxExpressionContainer(r.callExpression(r.identifier("$t"),[r.stringLiteral(o)])))}}}}),s};extractChar=i=>{let t=i.trim(),s=B(t);return this.locales[s]=t,s}},z=Y;var me="sugar18",ge="1.0.5",Ee="https://github.com/wood3n/sweet-i18n",he="a nodejs cli tool that transforms chinese characters automaticly",Se={build:"node esbuild.js"},xe={node:">= 14"},be={trust:"./bin/index.js"},Ce=["bin/**","lib/**"],de={"@types/babel__generator":"^7.6.3","@types/babel__traverse":"^7.14.2","@types/glob":"^7.2.0","@types/node":"^16.11.9","@types/prettier":"^2.4.2",esbuild:"^0.13.15","esbuild-node-externals":"^1.4.0",typescript:"^4.5.2"},Oe={"@babel/generator":"^7.16.0","@babel/parser":"^7.16.4","@babel/traverse":"^7.16.3","@babel/types":"^7.16.0","@vue/compiler-sfc":"^3.2.22",chalk:"^4.1.2",commander:"^8.3.0",glob:"^7.2.0","please-upgrade-node":"^3.2.0",prettier:"^2.4.1","ts-node":"^10.4.0"},V={name:me,version:ge,homepage:Ee,description:he,scripts:Se,engines:xe,bin:be,files:Ce,devDependencies:de,dependencies:Oe};(function(){require("please-upgrade-node")(V);let e={pattern:"**/*.{vue,js}",ignore:["node_modules/**"],output:"i18n/zh-CN.json",useUniqKey:!1,importPath:""};try{let l=h.default.readFileSync(O.default.resolve(process.cwd(),"package.json"),"utf8"),u=JSON.parse(l);u.sugar18&&(e=b(b({},e),u.sugar18))}catch(l){d(l),process.exit(1)}new Z.Command().name("sugar18").version(V.version).command("trust").option("-i --import","importExpression's filepath").option("-p --output","json output filepath").action((l,u)=>{u.output&&(u.output=u.output),u.import&&(u.importPath=u.import)}).parse(process.argv),e.importPath||(d("Please set import expression's filepath."),process.exit(1));let t={},s=O.default.resolve(process.cwd(),e.output);if(h.default.existsSync(s)){let l=h.default.readFileSync(s,"utf8");l&&(t=JSON.parse(l))}N.default.sync(e.pattern,{ignore:e.ignore}).forEach(l=>{let u=O.default.resolve(process.cwd(),l);M(`\u{1F680} detecting file: ${u}`);let a=h.default.readFileSync(u,"utf8");try{let{result:c}=new z({code:a,locales:t,useUniqKey:e.useUniqKey,importPath:e.importPath,filename:l});h.default.writeFileSync(u,c,"utf8")}catch(c){console.log(c)}}),Object.keys(t).length?(L(O.default.dirname(s)),h.default.writeFileSync(s,JSON.stringify(t,null,"	"),"utf8"),T("\u{1F389}\u{1F389}\u{1F389} Extract successfully!")):q("There is no chinese characters can be found in specified directory.")})();
//# sourceMappingURL=index.js.map
